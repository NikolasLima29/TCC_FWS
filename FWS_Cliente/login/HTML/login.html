<!DOCTYPE html>
<html lang="pt-br">

<head>
  <title>Login do Cliente</title>
  <link rel="icon" type="image/x-icon" href="../IMG/Shell.png">

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">

  <!-- Seu CSS personalizado -->
  <link rel="stylesheet" href="../CSS/login.css">

  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

</head>

<body>

  <div class="overlay"></div>

  <header>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
  </header>

  <div class="container-cadastro">

    <!-- Logo central -->
    <img src="../IMG/shellselect.png" alt="Logo Shell" class="logo-central">

    <main>
      <form action="../PHP/login.php" method="post" class="wrapper-cadastro container">
        <h1>Login</h1>

        <input type="hidden" name="login_form" value="1">

        <!-- Alternância entre CPF e E-mail -->
        <div class="d-flex mb-3" id="login-switch"
          style="border: 2px solid black; border-radius: 6px; overflow: hidden;">
          <div class="flex-fill text-center p-2 switch-tab active" id="switch-cpf" role="button" tabindex="0">CPF</div>
          <div class="flex-fill text-center p-2 switch-tab" id="switch-email" role="button" tabindex="0">E-mail</div>
        </div>

        <!-- Campo CPF ou E-mail -->
        <div class="mb-3">
          <label for="cpf_email" class="form-label">CPF ou E-mail:</label>
          <input type="text" class="form-control" id="cpf_email" name="cpf_email"
            placeholder="Digite seu CPF ou e-mail">
        </div>

        <!-- Campo Senha -->
        <div class="mb-3">
          <label for="senha" class="form-label">Senha:</label>
          <input type="password" class="form-control" id="senha" name="senha"
            pattern="^(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=\[\]{};':\\|,.<>\/?]).{6,}$"
            title="A senha deve ter ao menos 6 caracteres, uma letra maiúscula, um número e um caractere especial."
            required aria-required="true">
        </div>

        <!-- Alerta de Erros / Sucesso -->
        <div id="alertaLogin" class="mt-2 fw-semibold d-none alerta-pequeno" role="alert" aria-live="polite"></div>

        <!-- Login com Google -->
        <div id="g_id_onload" data-client_id="819532091119-afi9om14kjrp0s11aapravd1s4a7o1d6.apps.googleusercontent.com"
          data-context="signin" data-ux_mode="redirect"
          data-login_uri="http://localhost/TCC_FWS/FWS_Cliente/login/PHP/Google_login.php" data-auto_prompt="false">
        </div>

        <div class="g_id_signin" data-type="standard"></div>

        <!-- Botão -->
        <button type="submit" class="btn-primary">Entrar</button>
      </form>
    </main>
  </div>

  <footer></footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.min.js" crossorigin="anonymous"></script>

  <!-- SCRIPT: Alternância CPF/E-mail -->
  <script>
    const switchCPF = document.getElementById('switch-cpf');
    const switchEmail = document.getElementById('switch-email');
    const inputCpfEmail = document.getElementById('cpf_email');

    function formatCPF(value) {
      value = value.replace(/\D/g, '').slice(0, 11);
      value = value.replace(/(\d{3})(\d)/, '$1.$2');
      value = value.replace(/(\d{3})(\d)/, '$1.$2');
      value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
      return value;
    }

    function activateTab(isCPF) {
      switchCPF.classList.toggle('active', isCPF);
      switchEmail.classList.toggle('active', !isCPF);

      inputCpfEmail.value = '';
      inputCpfEmail.type = isCPF ? 'text' : 'email';
      inputCpfEmail.placeholder = isCPF ? 'Digite seu CPF' : 'Digite seu e-mail';
      inputCpfEmail.maxLength = isCPF ? 14 : 50;

      if (isCPF) {
        inputCpfEmail.addEventListener('input', handleCPFMask);
      } else {
        inputCpfEmail.removeEventListener('input', handleCPFMask);
      }
    }

    function handleCPFMask(e) {
      e.target.value = formatCPF(e.target.value);
    }

    switchCPF.addEventListener('click', () => activateTab(true));
    switchEmail.addEventListener('click', () => activateTab(false));

    [switchCPF, switchEmail].forEach(tab => {
      tab.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          tab.click();
        }
      });
    });

    // Inicializa com CPF
    activateTab(true);
  </script>

  <!-- SCRIPT: Mensagem de login (erro ou sucesso) -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const params = new URLSearchParams(window.location.search);
      const status = params.get("status");
      const msg = params.get("msg");

      if (status && msg) {
        const alerta = document.getElementById("alertaLogin");
        alerta.classList.remove("d-none");

        if (status === "sucesso") {
          alerta.classList.add("alert-sucesso");
          alerta.innerHTML = "✅ " + decodeURIComponent(msg);
          setTimeout(() => {
            alerta.innerHTML += `
        <div class="mt-1 d-flex justify-content-center align-items-center">
          <div class="spinner-border text-dark me-2" role="status" aria-hidden="true"></div>
          <span class="texto-spinner">Carregando...</span>
        </div>
      `;
          }, 1200);
          setTimeout(() => {
            // redireciona pro menu (ou não)
            window.location.href = "../../index.php";
          }, 3500);

        } else {
          alerta.classList.add("alert-erro");
          alerta.innerHTML = "❌ " + decodeURIComponent(msg);
        }

        // ✅ Limpa os parâmetros da URL sem recarregar a página
        const url = new URL(window.location);
        url.searchParams.delete("status");
        url.searchParams.delete("msg");
        window.history.replaceState({}, document.title, url.toString());
      }

    });
  </script>

</body>

</html>