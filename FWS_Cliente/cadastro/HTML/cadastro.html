<!doctype html>
<html lang="pt-br">

<head>
  <title>Página de Cadastro</title>
  <link rel="icon" type="image/x-icon" href="../IMG/Shell.png">

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
  <link rel="stylesheet" href="../CSS/cadastro.css">

   
  
</head>

<body>
  <div class="overlay"></div>

  <div class="container-cadastro">
    <img src="../IMG/shellselect.png" alt="Logo Shell" class="logo-central">

    <main>
      <form action="../PHP/cadastro.php" method="post" class="wrapper-cadastro container">
        <h1>Cadastro</h1>
        <input type="hidden" name="cadastro_form" value="1">

        <!-- Nome e E-mail -->
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="nome" class="form-label">Nome completo:</label>
            <input type="text" class="form-control" id="nome" name="nome" placeholder="Ex: Maria da Silva" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="email" class="form-label">E-mail:</label>
            <input type="email" class="form-control" id="email" name="email" placeholder="Ex: maria@gmail.com" required>
          </div>
        </div>

        <!-- Data de Nascimento, CPF e Telefone -->
        <div class="row">
          <div class="col-md-4 mb-3">
            <label for="data" class="form-label">Data de Nascimento:</label>
            <input type="date" class="form-control" id="data" name="data" required>
          </div>
          <div class="col-md-4 mb-3">
            <label for="cpf" class="form-label">CPF:</label>
            <input type="text" class="form-control" id="cpf" name="cpf" placeholder="Ex: 123.456.789-00" required>
          </div>
          <div class="col-md-4 mb-3">
            <label for="telefone" class="form-label">Telefone:</label>
            <input type="tel" class="form-control" id="telefone" name="telefone" placeholder="Ex: (11) 91234-5678" required>
          </div>
        </div>

        <!-- Senha e Confirmar Senha -->
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="senha" class="form-label">Senha:</label>
            <input type="password" class="form-control" id="senha" name="senha" required
              pattern="(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*]).{6,}">
          </div>
          <div class="col-md-6 mb-3">
            <label for="con_senha" class="form-label">Confirmar senha:</label>
            <input type="password" class="form-control" id="con_senha" name="con_senha" required>
          </div>
        </div>

        <!-- Checkbox Termos -->
 
<div class="form-check d-flex align-items-center justify-content-center mb-4">
  <input type="checkbox" class="form-check-input me-2" id="termos" name="termos" required>
  <label class="form-check-label" for="termos">
    Concordo com os <a href="../docs/termos_politicas.pdf" download target="_blank">termos e políticas</a>
  </label>
</div>


        <div id="alertaCadastro" class="alert d-none mt-3 text-center" role="alert"></div>

        <button type="submit" class="btn-primary">Cadastrar</button>
      </form>
    </main>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
    integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.min.js"
    integrity="sha384-7VPbUDkoPSGFnVtYi0QogXtr74QeVeeIs99Qfg5YCF+TidwNdjvaKZX19NZ/e6oz" crossorigin="anonymous"></script>


     
  <script>
    // Máscara de CPF
    document.getElementById("cpf").addEventListener("input", function (e) {
      let value = e.target.value.replace(/\D/g, "");
      if (value.length > 11) value = value.slice(0, 11);
      value = value.replace(/(\d{3})(\d)/, "$1.$2");
      value = value.replace(/(\d{3})(\d)/, "$1.$2");
      value = value.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
      e.target.value = value;
    });

    // Máscara de telefone
    document.getElementById("telefone").addEventListener("input", function (e) {
      let value = e.target.value.replace(/\D/g, "");
      if (value.length > 11) value = value.slice(0, 11);
      value = value.replace(/^(\d{2})(\d)/g, "($1) $2");
      value = value.replace(/(\d{5})(\d{1,4})$/, "$1-$2");
      e.target.value = value;
    });

    // Validação de senha
    document.getElementById("senha").addEventListener("input", function () {
      const regex = /^(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*]).{6,}$/;
      this.setCustomValidity(regex.test(this.value) ? "" : "A senha deve ter 6 caracteres, uma maiúscula, um número e um símbolo.");
    });

    // Validação de idade mínima
    document.getElementById("data").addEventListener("input", function () {
      const nasc = new Date(this.value);
      const hoje = new Date();
      let idade = hoje.getFullYear() - nasc.getFullYear();
      const m = hoje.getMonth() - nasc.getMonth();
      if (m < 0 || (m === 0 && hoje.getDate() < nasc.getDate())) idade--;
      this.setCustomValidity(idade < 18 ? "Você deve ter pelo menos 18 anos." : "");
    });
  </script>


  <script>
  function validarCPF(cpf) {
    cpf = cpf.replace(/[^\d]+/g, '');
    if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;
    let soma, resto;
    soma = 0;
    for (let i = 1; i <= 9; i++) soma += parseInt(cpf.substring(i - 1, i)) * (11 - i);
    resto = (soma * 10) % 11;
    if (resto === 10 || resto === 11) resto = 0;
    if (resto !== parseInt(cpf.substring(9, 10))) return false;
    soma = 0;
    for (let i = 1; i <= 10; i++) soma += parseInt(cpf.substring(i - 1, i)) * (12 - i);
    resto = (soma * 10) % 11;
    if (resto === 10 || resto === 11) resto = 0;
    return resto === parseInt(cpf.substring(10, 11));
  }

  function validarTelefone(telefone) {
    telefone = telefone.replace(/\D/g, "");
    if (!(telefone.length >= 10 && telefone.length <= 11)) return false;
    if (telefone.length === 11 && parseInt(telefone.substring(2, 3)) !== 9) return false;
    const dddsValidos = [11,12,13,14,15,16,17,18,19,21,22,24,27,28,31,32,33,34,35,37,38,41,42,43,44,45,46,47,48,49,51,53,54,55,61,62,63,64,65,66,67,68,69,71,73,74,75,77,79,81,82,83,84,85,86,87,88,89,91,92,93,94,95,96,97,98,99];
    if (!dddsValidos.includes(parseInt(telefone.substring(0, 2)))) return false;
    return true;
  }

  document.querySelector("form").addEventListener("submit", function (e) {
    const alerta = document.getElementById("alertaCadastro");
    alerta.classList.remove("d-none", "alert-success", "alert-danger");
    const cpf = document.getElementById("cpf").value;
    const telefone = document.getElementById("telefone").value;
    alerta.innerHTML = "";

    if (!validarCPF(cpf)) {
      e.preventDefault();
      alerta.classList.add("alert", "alert-danger");
      alerta.innerHTML = "⚠️ CPF inválido! Verifique e tente novamente.";
      document.getElementById("cpf").focus();
      return false;
    }

    if (!validarTelefone(telefone)) {
      e.preventDefault();
      alerta.classList.add("alert", "alert-danger");
      alerta.innerHTML = "⚠️ Telefone inválido! Digite no formato correto (ex: (11) 91234-5678).";
      document.getElementById("telefone").focus();
      return false;
    }

    alerta.classList.add("d-none"); // Se estiver tudo certo, oculta o alerta
    return true;
  });
</script>



<script>
    document.addEventListener("DOMContentLoaded", () => {
      const params = new URLSearchParams(window.location.search);
      const status = params.get("status");
      const msg = params.get("msg");
      const alerta = document.getElementById("alertaCadastro");
      const form = document.querySelector("form");
      if (status && msg) {
        alerta.classList.remove("d-none", "alert-success", "alert-danger");
        if (status === "sucesso") {
          alerta.classList.add("alert", "alert-success");
          alerta.innerHTML = "✅ " + decodeURIComponent(msg);
          setTimeout(() => {
            alerta.innerHTML += `
            <div class="mt-1 d-flex justify-content-center align-items-center">
              <div class="spinner-border text-dark me-2" role="status" aria-hidden="true"></div>
              <span class="texto-spinner">Redirecionando...</span>
            </div>
          `;
          }, 2500);
          setTimeout(() => {
            window.location.href = "../../login/HTML/login.html";
          }, 3500);
        } else {
          alerta.classList.add("alert", "alert-danger");
          alerta.innerHTML = "❌ " + decodeURIComponent(msg);
          const msgDecoded = decodeURIComponent(msg);
          if (msgDecoded === "senhas não coincidem, tente novamente") {
            form.querySelector("#senha").value = "";
            form.querySelector("#con_senha").value = "";
            form.querySelector("#senha").focus();
          } else if (msgDecoded === "E-mail ou CPF já cadastrados" || msgDecoded === "E-mail, CPF ou Telefone já cadastrados.") {
            form.reset();
          }
          // Outros erros não limpam campos
        }
      }
    });
  </script>




</body>

</html>
